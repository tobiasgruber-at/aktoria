<app-page-layout [loading]="getLoading">
  <div class="d-flex flex-column align-items-start flex-grow-1">
    <div class="row w-100">
      <div class="col-9 d-flex flex-column">
        <h1 class="display-3 mb-3 text-truncate">{{ script?.name }}</h1>
        <app-script-roles-list
          (roleClicked)="selectRole($event)"
          [roles]="script?.roles"
          [selectedRole]="selectedRole"
          [showTooltips]="true"
          size="xl"
          theme="primary"
        ></app-script-roles-list>
      </div>
      <div class="col-3 d-flex flex-column align-items-end">
        <div
          [ngbTooltip]="!selectedRole ? 'Bitte wähle eine Rolle aus' : ''"
          class="mb-3 mt-2"
          placement="bottom"
        >
          <button
            [disabled]="!selectedRole"
            class="start-rehearsal btn btn-primary btn-lg d-flex align-items-center justify-content-between"
            routerLink="/scripts/{{ script?.id }}/rehearse/sections"
          >
            Rolle proben
            <bi name="play-fill"></bi>
          </button>
        </div>
        <!--<button
          class="btn btn-outline-primary btn-lg mb-3"
          routerLink="/scripts/{{ script?.id }}/view"
        >
          Skript ansehen
        </button>-->
        <div dropdownClass="dropdown-menu-lg" ngbDropdown>
          <button class="btn btn-outline-secondary btn-lg" ngbDropdownToggle>
            Weitere Aktionen
          </button>
          <div ngbDropdownMenu>
            <button ngbDropdownItem routerLink="/scripts/{{ script?.id }}/view">
              Ansehen
            </button>
            <button ngbDropdownItem routerLink="/scripts/{{ script?.id }}/edit">
              Bearbeiten
            </button>
            <button
              *ngIf="isOwner()"
              ngbDropdownItem
              routerLink="/scripts/{{ script?.id }}/invite"
            >
              Mitglied einladen
            </button>
            <button
              (click)="openModal(deleteModal)"
              *ngIf="isOwner()"
              ngbDropdownItem
            >
              Löschen
            </button>
            <button (click)="openModal(exitModal)" ngbDropdownItem>
              Austreten
            </button>
          </div>
        </div>
      </div>
      <app-script-members-list
        [isOwner]="isOwner()"
        [members]="members"
      ></app-script-members-list>
    </div>
  </div>
</app-page-layout>
<ng-template #deleteModal let-modal>
  <app-modal
    (confirm)="deleteScript(modal)"
    (decline)="modal.dismiss()"
    [loading]="deleteLoading"
    [theme]="theme.danger"
    confirmBtnLabel="Löschen"
    title="Skript löschen"
  >
    <app-alert
      *ngIf="deleteError"
      [closeable]="false"
      class="mb-1"
      type="danger"
    >{{ this.deleteError }}</app-alert
    >
    Sicher, dass du
    <i>{{ script?.name }} </i>
    <strong class="text-primary">unwiderruflich löschen</strong>
    möchtest möchtest?
  </app-modal>
</ng-template>
<ng-template #exitModal let-modal>
  <app-modal
    (confirm)="exitScript(modal)"
    (decline)="modal.dismiss()"
    [loading]="deleteLoading"
    [theme]="theme.danger"
    confirmBtnLabel="Austreten"
    title="Skript verlassen"
  >
    <app-alert *ngIf="deleteError" [closeable]="false" type="danger">{{
      this.deleteError
      }}</app-alert>
    Sicher, dass du
    <i>{{ script?.name }} </i>
    verlassen möchtest?
  </app-modal>
</ng-template>
