<div
  *ngIf="isEditingScript || line.active"
  [class.py-2]="isInstruction"
  class="py-1"
>
  <div
    (openChange)="setIsActive($event)"
    class="d-flex px-5"
    ngbDropdown
    placement="bottom-end top-end bottom-start top-start"
  >
    <div *ngIf="!isInstruction" class="roles px-1">
      <ng-container *ngIf="!sameRolesAsPrevLine">
        <span
          *ngFor="let role of line?.roles; let i = index"
          class="d-inline-block"
        >{{ role.name }}{{ i < line?.roles.length - 1 ? ', ' : '' }}</span
        >
      </ng-container>
    </div>
    <!-- TODO: remove dropdown toggle when only viewing mode, as it throws errors -->
    <p
      [ngbTooltip]="isConflict() ? 'Bitte überprüfe diese Zeile' : null"
      [class.fst-italic]="isInstruction"
      [class.highlighted]="
        isHighlighted(scriptViewerService.$selectedRole | async)
      "
      [class.conflict]="isConflict()"
      [class.conflict-error]="isConflictError()"
      [class.conflict-warning]="isConflictWarning()"
      [class.text-secondary]="isInstruction"
      class="w-100"
      ngbDropdownToggle
    >
      {{ line?.content }}
    </p>
    <div *ngIf="isEditingScript" class="my-1 shadow" ngbDropdownMenu>
      <button (click)="toggleModal(changeLineModal)" ngbDropdownItem>
        Bearbeiten
      </button>
      <button
        (click)="removeRoles()"
        *ngIf="line.roles?.length > 0"
        ngbDropdownItem
      >
        Als Instruktion markieren
      </button>
      <button (click)="toggleLineActive()" ngbDropdownItem>
        {{ line.active ? 'Ausblenden' : 'Einblenden' }}
      </button>
      <button *ngIf="line.conflictType !== null" (click)="ignoreConflict()" ngbDropdownItem>
        Überprüfungsanweisung ignorieren
      </button>
    </div>
    <ng-template #changeLineModal let-modal>
      <app-change-line-modal
        [line]="line"
        [modal]="modal"
      ></app-change-line-modal>
    </ng-template>
  </div>
</div>
<div *ngIf="section?.startLine.index === line.index" class="marking start-line">
  <span>{{ section?.name || 'Start' }}</span>
</div>
<div *ngIf="section?.endLine.index === line.index" class="marking end-line">
  <span>Ende</span>
</div>
<!--
  Line anchor to scroll to. necessary to not scroll directly on the top of the line,
  but a little further up
-->
<div #scrollAnchor class="scroll-anchor"></div>
